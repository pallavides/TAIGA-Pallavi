/*
 * pendulum_control.c
 *
 *  Created on: Mar 31, 2015
 *      Author: teja
 */

#include "pendulum_control.h"

static QueuePacket fifo_packet;
static unsigned int buffer[8];

int getSetPoint(){
	fifo_packet.command = SET_POINT;
	fifo_packet.operation = READ;
	fifo_packet.bytes = BITS_0;
	fifo_packet.slave = NO_SLAVE;
	fifo_packet.length = 0;

	enqueue(&fifo_packet);

	dequeue(buffer);

	return buffer[0];
}

int readEncoder(slave_select encoder){
	fifo_packet.command = PLANT;
	fifo_packet.operation = READ;
	fifo_packet.bytes = BITS_32;
	fifo_packet.slave = encoder;
	fifo_packet.length = 1;
	enqueue_production_to_taiga((SPI << 24) |(READ << 16) | (BITS_32 << 8) | encoder);
	enqueue_production_to_taiga((READ_CNTR << 24));
	unsigned int value = dequeue_taiga_to_production();
	value &= ~(0xFF0000FF);
	value = (value >> 8);
	return value;
}

float readADC(){

}

int writeDAC(float voltage){

}
